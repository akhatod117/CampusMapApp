<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8' />
    <title>Delivery App</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://npmcdn.com/@turf/turf/turf.min.js'></script>
    <script src='https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js'></script>
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v2.2.0/mapbox-gl.js'></script>
    <script>

          var inputs = [];

          var count = 1;
          for(count = 1; count<6; count++){
            //alert("count: " + count);
            var url = new URL(location.href).searchParams.get('class'+count);
            //alert(url);
            if(url == null){
               continue;
            }
            inputs.push(url);
          }
          //alert(inputs);

          var urlstore = [];
          var i = 0;
          for( i = 0; i< inputs.length; i++){
            //alert("inputs[i]: " + inputs[i]);
            var apiUrl = "https://api.mapbox.com/geocoding/v5/mapbox.places/"+inputs[i]+".json?proximity=38.033554,-78.507980&access_token=pk.eyJ1IjoiY2F2bWFwcCIsImEiOiJja21sMTQ2bGIwMzJqMnZuM2sxdmJyN3NxIn0.SmVfbpZ7nZF6HqbgiJSaog&limit=1";
            //alert("apiUrl: " + apiUrl);
            urlstore.push(apiUrl);
          }

          //has all the appropriate urls to perform the get request.
          //now need to loop through all urls to actually perform the get request and retrieve the coordinate values.
          //alert(urlstore);



          console.log("urlstore[0]: " + urlstore[0]);

          getCoordinates();

          async function getCoordinates(){
             var arrayOfCoordinates = []
             var j=0;
            for(j = 0; j<urlstore.length; j++){
               const response = await fetch(urlstore[j]);
               const data = await response.json();
               let coordinate = data.features[0].geometry.coordinates;
              // console.log("coordinate: " + coordinate);
              // console.log("coordinate[0]: " + coordinate[0]);
               arrayOfCoordinates.push(coordinate);
            }


            var x = 0;
            var apiString = '';
            for(x = 0; x < (arrayOfCoordinates.length); x++){
               apiString += arrayOfCoordinates[x]+';';
            }

            return apiString;
            //console.log("arrayOfCoordinates: " + arrayOfCoordinates);

            //return arrayOfCoordinates;

          }














          //console.log("arrayOfCoordinates: " + arrayOfCoordinates);





          var r = window.location.search;
          //alert(r);

      </script>

    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v2.2.0/mapbox-gl.css' rel='stylesheet' />
    <style>
        body { margin: 0; padding: 0; }
        #map { position: absolute; top: 25%; bottom: 25%; width: 50%; height: 50%; left: 25%; }
    </style>
  </head>
  <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.1.0/mapbox-gl-directions.js"></script>
<link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.1.0/mapbox-gl-directions.css" type="text/css">
  <body>


      <p>
        this is a test...hopefully this works???
      </p>



    <div id='map' class='contain'></div>
    <script>

        // TO MAKE THE MAP APPEAR YOU MUST
        // ADD YOUR ACCESS TOKEN FROM
        // https://account.mapbox.com
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(mapInfo);
      } else {
        x.innerHTML = "Geolocation is not supported by this browser.";
      }
      function mapInfo(position){
        mapboxgl.accessToken = 'pk.eyJ1IjoiY2F2bWFwcCIsImEiOiJja21sMTQ2bGIwMzJqMnZuM2sxdmJyN3NxIn0.SmVfbpZ7nZF6HqbgiJSaog';
    var map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/streets-v11',
    center: [position.coords.longitude, position.coords.latitude],
    zoom: 12
    });
    var directions = new MapboxDirections({
            accessToken: mapboxgl.accessToken
        });

    //map.addControl(directions,'top-left');

    map.on('load',  function() {
        directions.setOrigin([position.coords.longitude, position.coords.latitude]);
        var currentPos =  [position.coords.longitude, position.coords.latitude];
        console.log("currentPos: " + currentPos);
        //var myString = getCoordinates();
        //console.log("myString: " + myString);

    })}
    </script>



  </body>
</html>